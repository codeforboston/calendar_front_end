!function(e,t,a,n){"use strict";function r(e){return t.getElementById(e).innerHTML}function o(e){return e.toLowerCase().split(" ").join("-")}function i(e){return e.map(function(e){return{title:e.title,start:moment(e.start_date),end:moment(e.end_date),organizer:e.organizer,url:e.url,editable:!1,startEditable:!1,durationEditable:!1,className:o(e.organizer)}})}function l(e){return e.split(" ").map(function(e){return 0===e.toLowerCase().indexOf("http")?'<a href="'+e+'" target="_blank">'+e+"</a>":e}).join(" ")}function d(e,t){return e.filter(function(e){var a=moment(e.start_date),n=moment(e.end_date);return a.dayOfYear()===t.dayOfYear()||n.dayOfYear()===t.dayOfYear()?!0:a.dayOfYear()<=t.dayOfYear()&&n.dayOfYear()>=t.dayOfYear()?!0:!1})}function c(e){var t,a=moment(e.start_date),n=moment(e.end_date);return t=a.format("L")===n.format("L")?a.fromNow()+" | "+a.format("L"):a.format("L")+" - "+n.format("L"),{title:e.title,organizer:e.organizer,dateString:t,location:e.location,description:l(e.description)}}var s={EVENTS:"https://boston-civic-calendar.herokuapp.com/api/v1/events",NEW_EVENT:"https://boston-civic-calendar.herokuapp.com/events/new"},u=a(t),h={$tooltips:a('[data-toggle="tooltip"]'),$newSourceLink:a('[data-hook="new-event-link"]'),$main:a("[data-hook=main]"),$eventsPanel:a("[data-hook=events-panel]"),$errorPanel:a("[data-hook=error-panel]"),$calendarList:a('[data-hook="list-container"]'),$calendar:a('[data-hook="calendar-container"]'),$calendarDetail:a('[data-hook="calendar-detail"]'),$calendarDetailList:a('[data-hook="calendar-detail-events-list"]'),$hideDetail:a('[data-hook="hide-detail"]')},f={calendarList:n.template(r("calendar-list"))};h.$tooltips.tooltip(),h.$newSourceLink.attr("href",s.NEW_EVENT),a.getJSON(s.EVENTS).error(function(e){console.log(e),h.$errorPanel.removeClass("hidden")}).done(function(e){h.$eventsPanel.removeClass("hidden");var t=i(e);h.$calendar.fullCalendar({events:t,theme:!1,aspectRatio:2,header:{left:"title",center:"month,agendaWeek,agendaDay",right:"today prev,next"},dayClick:function(t){var a=d(e,t);u.trigger("calendarDetail:show",{events:a})},eventClick:function(t){var a=d(e,t._start);return u.trigger("calendarDetail:show",{events:a}),!1},eventMouseover:function(e){a(this).tooltip({title:e.title+" <br/> "+e.organizer,html:!0}),a(this).tooltip("show")},eventMouseout:function(){a(this).tooltip("hide"),a(this).tooltip("destroy")}});var r={events:n.map(e,c)},o=f.calendarList(r);h.$calendarList.append(o)}),u.on("calendarDetail:show",function(e,t){var a={events:n.map(t.events,c)};if(a.events.length){var r=f.calendarList(a);h.$calendarDetailList.html(r),h.$calendarDetail.removeClass("hidden")}}),u.on("calendarDetail:hide",function(){h.$calendarDetail.addClass("hidden")}),h.$hideDetail.on("click",function(){u.trigger("calendarDetail:hide")})}(window,document,$,_);